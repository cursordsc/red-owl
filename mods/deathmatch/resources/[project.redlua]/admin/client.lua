temp = nil
temp = createObject(14623, 275.761475, -2052.245605, 3089.291962, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 281.021301, -2071.728027, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 279.404907, -2071.685059, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 277.808746, -2071.687012, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 276.206329, -2071.687012, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 274.598267, -2071.696289, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 272.981079, -2071.688232, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 271.358154, -2071.681641, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 269.751190, -2071.647949, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 264.887604, -2035.191895, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 266.480377, -2035.177368, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 268.104004, -2035.175659, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 269.711609, -2035.164673, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 271.328827, -2035.151001, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 272.949799, -2035.164551, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 274.531433, -2035.162842, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 276.146271, -2035.148804, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 277.724762, -2035.133545, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 279.347931, -2035.131836, 3085.729301, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 280.966156, -2035.121460, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 282.580139, -2035.108887, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 284.188782, -2035.107544, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 285.805969, -2035.087524, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(3441, 287.421600, -2035.090698, 3085.722839, 0.0000, 0.0000, 0.0000)
temp = createObject(8947, 278.112823, -2079.902832, 3084.662460, 0.0000, 0.0000, 269.7591)
temp = createObject(8947, 276.329285, -2026.489014, 3086.593712, 0.0000, 0.0000, 270.6186)
temp = createObject(3461, 261.211426, -2041.465210, 3085.322182, 0.0000, 0.0000, 0.0000)
temp = createObject(3461, 257.850983, -2052.097656, 3085.322182, 0.0000, 0.0000, 0.0000)
temp = createObject(3461, 265.256958, -2066.523926, 3085.328644, 0.0000, 0.0000, 0.0000)
temp = createObject(3461, 292.807556, -2046.467041, 3085.322182, 0.0000, 0.0000, 0.0000)
temp = createObject(3461, 292.870514, -2057.545654, 3085.322182, 0.0000, 0.0000, 0.0000)
temp = createObject(3461, 287.510376, -2065.128418, 3085.322182, 0.0000, 0.0000, 0.0000)
temp = createObject(2207, 274.597260, -2052.552979, 3083.740692, 0.0000, 0.0000, 348.7500)
temp = createObject(2207, 276.775726, -2051.066406, 3083.740692, 0.0000, 0.0000, 168.7500)
temp = createObject(1724, 275.219055, -2049.610840, 3083.745178, 0.0000, 0.0000, 359.1406)
temp = createObject(1724, 273.704681, -2050.987793, 3083.745178, 0.0000, 0.0000, 56.7228)
temp = createObject(1724, 274.134216, -2053.263428, 3083.745178, 0.0000, 0.0000, 122.0400)
temp = createObject(1724, 276.121979, -2054.058838, 3083.745178, 0.0000, 0.0000, 178.7628)
temp = createObject(1724, 277.373474, -2050.241211, 3083.745178, 0.0000, 0.0000, 302.4177)
temp = createObject(1724, 277.813293, -2052.552979, 3083.745178, 0.0000, 0.0000, 236.2411)
temp = createObject(1485, 274.486328, -2052.510742, 3084.507332, 0.0000, 0.0000, 348.7500)
temp = createObject(1486, 275.974915, -2050.755615, 3084.663017, 0.0000, 0.0000, 0.0000)
temp = createObject(1520, 276.231201, -2051.734619, 3084.577194, 0.0000, 0.0000, 0.0000)
temp = createObject(1665, 276.263397, -2052.100830, 3084.553520, 0.0000, 0.0000, 0.0000)
temp = createObject(1667, 275.720825, -2052.869141, 3084.606644, 0.0000, 0.0000, 0.0000)

function enterCommand(commandName, ...)
	triggerServerEvent("checkCommandEntered", getLocalPlayer(), getLocalPlayer(), commandName, ...)
end
addCommandHandler("check", enterCommand, false, false)

function CreateCheckWindow()
	local width, height = guiGetScreenSize()	
	Button = {}
	Window = guiCreateWindow(width-400,0,400,385,"Karakter Bilgileri",false)
	guiWindowSetSizable(Window, false)
	Button[3] = guiCreateButton(0.85,0.86,0.12, 0.125,"Kapat",true,Window)
	addEventHandler( "onClientGUIClick", Button[3], CloseCheck )
	Label = {
		guiCreateLabel(0.03,0.06,0.95,0.0887,"İsim: N/A",true,Window),
		guiCreateLabel(0.03,0.10,0.66,0.0887,"IP: N/A",true,Window),
		guiCreateLabel(0.03,0.26,0.66,0.0887,"Para: N/A",true,Window),
		guiCreateLabel(0.03,0.30,0.17,0.0806,"Can: N/A",true,Window),
		guiCreateLabel(0.27,0.34,0.30,0.0806,"Zırh: N/A",true,Window),
		guiCreateLabel(0.03,0.34,0.17,0.0806,"Kıyafet: N/A",true,Window),
		guiCreateLabel(0.27,0.30,0.30,0.0806,"Silah: N/A",true,Window),
		guiCreateLabel(0.03,0.38,0.66,0.0806,"Birlik: N/A",true,Window),
		guiCreateLabel(0.03,0.18,0.66,0.0806,"Ping: N/A",true,Window),
		guiCreateLabel(0.03,0.42,0.66,0.0806,"Araç: N/A",true,Window),
		guiCreateLabel(0.03,0.46,0.66,0.0806,"Uyarı: N/A",true,Window),
		guiCreateLabel(0.03,0.50,0.97,0.0766,"Lokasyon: N/A",true,Window),
		guiCreateLabel(0.7,0.06,0.4031,0.0766,"X:",true,Window),
		guiCreateLabel(0.7,0.10,0.4031,0.0766,"Y: N/A",true,Window),
		guiCreateLabel(0.7,0.14,0.4031,0.0766,"Z: N/A",true,Window),
		guiCreateLabel(0.7,0.18,0.2907,0.0806,"Interior: N/A",true,Window),
		guiCreateLabel(0.7,0.22,0.2907,0.0806,"Dimension: N/A",true,Window),
		guiCreateLabel(0.03,0.14,0.66,0.0887,"Admin Level: N/A", true,Window),
		guiCreateLabel(0.7,0.26,0.4093,0.0806,"Karakter Saati: N/A\n~ Toplam: N/A",true,Window),
		guiCreateLabel(0.03,0.22,0.66,0.0887,"Bakiye: N/A", true,Window),
		guiCreateLabel(0.03,0.50,0.66,0.0806,"",true,Window),
	}
	
	-- player notes
	memo = guiCreateMemo(0.03, 0.55, 0.8, 0.42, "", true, Window)
	addEventHandler( "onClientGUIClick", Window,
		function( button, state )
			if button == "left" and state == "up" then
				if source == memo then
					guiSetInputEnabled( true )
				else
					guiSetInputEnabled( false )
				end
			end
		end
	)
	Button[4] = guiCreateButton(0.85,0.55,0.12, 0.175,"Kaydet\nNot",true,Window)
	
	addEventHandler( "onClientGUIClick", Button[4], SaveNote, false )
	
	Button[5] = guiCreateButton(0.7,0.375,0.4093,0.15,"Geçmiş: N/A",true,Window)
	addEventHandler( "onClientGUIClick", Button[5], ShowHistory, false )
	
	Button[6] = guiCreateButton(0.85,0.73,0.12,0.125,"Inv.",true,Window)
	addEventHandler( "onClientGUIClick", Button[6], showInventory, false )

	guiSetVisible(Window, false)
end

addEventHandler("onClientResourceStart", getResourceRootElement(getThisResource()),
	function ()
		CreateCheckWindow()
	end
)

function OpenCheck( ip, adminreports, donPoints, note, history, warns, transfers, bankmoney, money, adminlevel, hoursPlayed, accountname, hoursAcc )
	player = source

	-- accountname
	guiSetText ( Label[1], "İsim: " .. getPlayerName(player):gsub("_", " ") .. " ("..accountname..")")
	if adminreports == nil then
		adminreports = "-1"
	end
	
	
	if donPoints == nil then
		donPoints = "Belirsiz"
	end
	
	if transfers == nil then
		transfers = "N/A"
	end
	
	if warns == nil then
		warns = "N/A"
	end
	
	if history == nil then
		history = "N/A"
	else
		local total = 0
		local str = {}
		for key, value in ipairs(history) do
			total = total + value[2]
			table.insert(str, value[2] .. " " .. getHistoryAction(value[1]))
			if key % 2 == 0 and key < #history then
				table.insert( str, "\n" )
			end
		end
		history = table.concat(str, " ")
	end
	
	if bankmoney == nil then
		bankmoney = "-1"
	end
	
	guiSetText ( Label[2], "IP: " .. ip )
	guiSetText ( Label[18], "Admin Level: " ..adminlevel.. " (" .. adminreports .. " Reports)" )
	guiSetText ( Label[11], "Uyarı: " .. warns )
	if not exports["integration"]:isPlayerTrialAdmin(getLocalPlayer()) then
		guiSetText ( Label[3], "Para: N/A (Banka: N/A)")
	else	
		guiSetText ( Label[3], "Para: " .. exports["global"]:formatMoney(money) .. "$ (Banka: " .. exports["global"]:formatMoney(bankmoney) .. ")$")
	end
	guiSetText ( Button[5], history )
	guiSetText ( Label[20], "Bakiye: " .. exports["global"]:formatMoney(donPoints) )
	guiSetText ( Label[19], "Karakter Saati: " .. ( hoursPlayed or "N/A" ) .. "\n~ Toplam: " .. ( hoursAcc or "N/A" ) )
	
	if (player == getLocalPlayer()) and not exports["integration"]:isPlayerAdmin(getLocalPlayer()) then
		guiSetText ( memo, "Kendi notlarını göremezsin!")
		guiMemoSetReadOnly(memo, true)
		guiSetEnabled(Button[4], false)
	elseif not exports["integration"]:isPlayerTrialAdmin(getLocalPlayer()) then
		guiSetText ( memo, "Notları görmeye yetkin yok.")
		guiMemoSetReadOnly(memo, true)
		guiSetEnabled(Button[4], false)
	else
		guiSetText ( memo, note or "ERROR: COULD NOT FETCH NOTE")
		guiSetEnabled(Button[4], true)
		guiMemoSetReadOnly(memo, false)
	end

	if not guiGetVisible( Window ) then
		guiSetVisible(Window, true)
	end
end

addEvent( "onCheck", true )
addEventHandler( "onCheck", getRootElement(), OpenCheck )


addEventHandler( "onClientRender", getRootElement(),
	function()
		if guiGetVisible(Window) and isElement( player ) then
			local x, y, z = 0, 0, 0
			if not exports["integration"]:isPlayerSupporter(getLocalPlayer()) and getElementAlpha(player) ~= 0 or exports["integration"]:isPlayerSeniorAdmin(getLocalPlayer()) then 
				x, y, z = getElementPosition(player)
				guiSetText ( Label[13], "X: " .. string.format("%.5f", x) )
				guiSetText ( Label[14], "Y: " .. string.format("%.5f", y) )
				guiSetText ( Label[15], "Z: " .. string.format("%.5f", z) )
			
			else
				guiSetText ( Label[13], "X: N/A" )
				guiSetText ( Label[14], "Y: N/A" )
				guiSetText ( Label[15], "Z: N/A" )
			end
			
			guiSetText ( Label[4], "Can: " .. math.floor( getElementHealth( player ) ) )
			guiSetText ( Label[5], "Zırh: " .. math.floor( getPedArmor( player ) ) )
			guiSetText ( Label[6], "Kıyafet: " .. getElementModel( player ) )
			
			local weapon = getPedWeapon( player )
			if weapon then
				weapon = getWeaponNameFromID( weapon )
			else
				weapon = "N/A"
			end
			guiSetText ( Label[7], "Silah: " .. weapon )

			local team = getPlayerTeam(player)
			if team then --and exports["integration"]:isPlayerAdmin(getLocalPlayer()) then -- Maxime | Faction info is visible for Lead+ only
				guiSetText ( Label[8], "Birlik: " .. getTeamName(team) )
			else
				guiSetText ( Label[8], "Birlik: N/A")
			end
			guiSetText ( Label[9], "Ping: " .. getPlayerPing( player ) )
			
			local vehicle = getPedOccupiedVehicle( player )
			if vehicle and not exports["integration"]:isPlayerSupporter(getLocalPlayer()) then
				guiSetText ( Label[10], "Araç: " .. exports["global"]:getVehicleName( vehicle ) .. " (" ..getVehicleName( vehicle ).." - "..getElementData( vehicle, "dbid" ) .. ")" )
			else
				guiSetText ( Label[10], "Araç: N/A")
			end
			if not exports["integration"]:isPlayerSupporter(getLocalPlayer()) then
				guiSetText ( Label[12], "Lokasyon: " .. getZoneName( x, y, z ) )
				guiSetText ( Label[16], "Interior: " .. getElementInterior( player ) )
				guiSetText ( Label[17], "Dimension: " .. getElementDimension( player ) )
			else
				guiSetText ( Label[12], "Lokasyon: N/A" )
				guiSetText ( Label[16], "Interior: N/A" )
				guiSetText ( Label[17], "Dimension: N/A" )
			end
		end
	end
)

function CloseCheck( button, state )
	if source == Button[3] and button == "left" and state == "up" then
		triggerEvent("cursorHide", getLocalPlayer())
		guiSetVisible( Window, false )
		guiSetInputEnabled( false )
		player = nil
	end
end

function SaveNote( button, state )
	if source == Button[4] and button == "left" and state == "up" then
		local text = guiGetText(memo)
		if text then
			triggerServerEvent("savePlayerNote", getLocalPlayer(), player, text)
		end
	end
end

function ShowHistory( button, state )
	if source == Button[5] and button == "left" and state == "up" then
		triggerServerEvent( "showAdminHistory", getLocalPlayer(), player )
	end
end

function showInventory( button, state )
	if source == Button[6] and button == "left" and state == "up" then
		if not exports["integration"]:isPlayerSupporter(getLocalPlayer()) then
			triggerServerEvent( "admin:showInventory", player )
		end
	end
end

local wHist, gHist, bClose, lastElement

-- window


addEvent( "cshowAdminHistory", true )
addEventHandler( "cshowAdminHistory", getRootElement(),
	function( info, targetID )
		if wHist then
			destroyElement( wHist )
			wHist = nil
			
			showCursor( false )
		else
			local sx, sy = guiGetScreenSize()
			
			local name
			if targetID == nil then
				name = getPlayerName( source )
			else
				name = " " .. tostring(targetID)
			end
			
			wHist = guiCreateWindow( sx / 2 - 350, sy / 2 - 250, 800, 600, "Admin Geçmişi: ".. name, false )
			
			-- date, action, reason, duration, a.username, c.charactername, id
			
			gHist = guiCreateGridList( 0, 0.04, 1, 0.88, true, wHist )
			local colID = guiGridListAddColumn( gHist, "ID", 0.05 )
			local colAction = guiGridListAddColumn( gHist, "İşlem", 0.07 )
			local colChar = guiGridListAddColumn( gHist, "Karakter", 0.2 )
			local colReason = guiGridListAddColumn( gHist, "Sebep", 0.25 )
			local colDuration = guiGridListAddColumn( gHist, "Zaman", 0.07 )
			local colAdmin = guiGridListAddColumn( gHist, "Yetkili", 0.15 )
			local colDate = guiGridListAddColumn( gHist, "Tarih", 0.15 )
			
			
			for _, res in pairs( info ) do
				local row = guiGridListAddRow( gHist )
				guiGridListSetItemText( gHist, row, colID,   res[7]  or "?", false, true )
				guiGridListSetItemText( gHist, row, colAction, getHistoryAction(res[2]), false, false )
				guiGridListSetItemText( gHist, row, colChar, res[6], false, false )
				guiGridListSetItemText( gHist, row, colReason, res[3], false, false )
				guiGridListSetItemText( gHist, row, colDuration, historyDuration( res[4], tonumber( res[2] ) ), false, false )
				guiGridListSetItemText( gHist, row, colAdmin, res[5], false, false )
				guiGridListSetItemText( gHist, row, colDate, res[1], false, false )
			end
		
			
			local bremove = guiCreateButton( 0, 0.93, 0.5, 0.07, "Kaldır", true, wHist )
			addEventHandler( "onClientGUIClick", bremove,
				function( button, state )
					if exports["integration"]:isPlayerTrialAdmin(localPlayer) or exports["integration"]:isPlayerSupporter(localPlayer) then
						local row, col = guiGridListGetSelectedItem( gHist )
						if row ~= -1 and col ~= -1 then
							local gridID = guiGridListGetItemText( gHist , row, col )
							local record = getHistoryRecordFromId(info, gridID)
							if tonumber(record[2]) == 6 then
								return outputChatBox( "This record is not removable.", 255, 0, 0 )
							end
							if not exports["integration"]:isPlayerSeniorAdmin(localPlayer) and tonumber(record[8]) ~= getElementData(localPlayer, "account:id") then
								return outputChatBox( "You can only remove admin history that you're the creator. Otherwise, it requires a Senior Admin or higher up.", 255, 0, 0 )
							end
							triggerServerEvent("admin:removehistory", getLocalPlayer(), gridID)
							destroyElement( wHist )
							wHist = nil
							showCursor( false )
						else
							outputChatBox( "You need to pick a record.", 255, 0, 0 )
						end
					else
						outputChatBox( "Please submit a ticket on Support Center to appeal and get this admin history record removed.", 255, 0, 0 )
					end
				end, false
			)
		
			
			bClose = guiCreateButton( 0.52, 0.93, 0.47, 0.07, "Kapat", true, wHist )
			addEventHandler( "onClientGUIClick", bClose,
				function( button, state )
					if button == "left" and state == "up" then
						destroyElement( wHist )
						wHist = nil
						
						showCursor( false )
					end
				end, false
			)
			
			showCursor( true )
		end
	end
)
 
-- WATCH

screenImage = nil
image = nil
name = ''
label = nil
local screenWidth, screenHeight = guiGetScreenSize( )
addEvent( "updateScreen", true )
addEventHandler( "updateScreen", root,
	function ( imageData, player )
		if fileExists( "temp.jpg" ) then
			fileDelete ( "temp.jpg" )
		end
		screenImage = fileCreate("temp.jpg")
		fileWrite(screenImage, imageData )            
		fileClose(screenImage)
		name = '( ' .. getElementData( player, "playerid" ) .. ' ) ' .. getPlayerName( player ):gsub("_", " ")
		if not image then
			image = guiCreateStaticImage( screenWidth - 210, 10, 200, 200, "temp.jpg", false )
			label = guiCreateLabel( screenWidth - 210, 210, 200, 30, name, false)
		end
		
	end
)

addEvent( "stopScreen", true )
addEventHandler( "stopScreen", root,
	function ( )
		if image then
			destroyElement( image )
			destroyElement( label )
		end
		image = nil
	end
)

addEventHandler( "onClientRender", root,
    function()
		if image then
			guiStaticImageLoadImage ( image, "temp.jpg" )
			guiSetText( label, name )
		end
    end
)
